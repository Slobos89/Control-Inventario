{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block titlepage %}Sistema Inventario - Hospital Padre Hurtado{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    body { background:#f7f9fc; }
    .sidebar { min-width: 220px; max-width: 260px; background: #fff; border-right:1px solid #e6eef8; height:100vh; padding-top:1rem; position:fixed; }
    main.flex-fill { margin-left: 260px; }
    .app-header { background: #0d6efd; color: #fff; }
    .card-compact { border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
    .nav-link.active { background: rgba(13,110,253,0.08); border-radius:6px; color:#0d6efd !important; }
    .small-muted { font-size:0.85rem; color:#ffffff; }
    .sidebar .nav { padding-left:0; }
    .sidebar .nav-link { color:#333; }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">
  
<nav class="navbar navbar-expand-lg app-header">
  <div class="container-fluid">
    <a class="navbar-brand text-white" href="{% url 'dashboard' %}">Inventario - Hospital Padre Hurtado</a>
    <div class="d-flex">
      {% if request.user.is_authenticated %}
          <div class="d-flex flex-column align-items-center text-white" style="min-width:80px;">

          <!-- Icono de usuario más pequeño -->
          <div class="rounded-circle bg-white d-flex justify-content-center align-items-center shadow" style="width:35px; height:35px;">
            <i class="bi bi-person-fill" style="font-size:18px; color:#0d6efd;"></i>
          </div>

          <!-- Nombre del usuario -->
          <div style="font-size:0.75rem; margin-top:3px; text-align:center;">
            <strong>{{ user.username }}</strong>
          </div>

          <!-- Botón cerrar sesión (tamaño exacto) -->
          <a href="{% url 'logout' %}" class="btn btn-outline-light btn-sm mt-1" style="font-size:0.70rem; padding: 2px 6px; white-space: nowrap; width: auto !important;">
            <i class="bi bi-box-arrow-right"></i>
            Salir
          </a>

        </div>

      {% else %}
        <a class="btn btn-outline-light btn-sm" href="{% url 'login' %}">Iniciar sesión</a>
      {% endif %}
    </div>
  </div>
</nav>

<div class="d-flex">
  <aside class="sidebar p-3">
    <h6 class="px-3">Menú</h6>
    {% with current=request.resolver_match.url_name %}
    <ul class="nav flex-column">
    {% if request.user.is_authenticated %}
    
      {% if request.user.perfil.rol == "ADMIN" or request.user.perfil.rol == "JEFE_BODEGA" or request.user.perfil.rol == "JEFE_FARMACIA" %}
      <!-- Dashboard del administrador -->
      <li class="nav-item">
        <a class="nav-link {% if current == 'dashboard' %}active{% endif %}" href="{% url 'dashboard' %}">
            Dashboard
        </a>
      </li>
      {% endif %}
      
      {% if request.user.perfil.rol == "FUNC_FARMACIA" or request.user.perfil.rol == "JEFE_FARMACIA" %}
      <li class="nav-item">
        <a class="nav-link {% if current == 'lista' %}active{% endif %}"
          href="{% url 'farmacia:medicamentos_lista' %}">
          Inventario Farmacia
        </a>
      </li>
      {% endif %}

      {% if request.user.perfil.rol == "JEFE_BODEGA" %}
      <li class="nav-item">
        <a class="nav-link {% if current == 'inventory_list' %}active{% endif %}" href="{% url 'inventory_list' %}">Inventario</a>
      </li>
      {% endif %}

      <li class="nav-item">
        <a class="nav-link {% if current == 'register_entry' %}active{% endif %}" href="{% url 'register_entry' %}">Ingresos</a>
      </li>

      <li class="nav-item">
        <a class="nav-link {% if current == 'requests' %}active{% endif %}" href="{% url 'requests' %}">Solicitudes</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-link {% if current == 'reports' %}active{% endif %}" href="{% url 'reports' %}">Reportes</a>
      </li>

    {% endif %}

      {% if user.is_authenticated and user.is_superuser %}
      <li class="nav-item">
        <a class="nav-link {% if current == 'manage_users' %}active{% endif %}" href="{% url 'manage_users' %}">Usuarios</a>
      </li>
      {% endif %}
    </ul>
    {% endwith %}
  </aside>

  <main class="flex-fill p-4">
    {% block principal %}
    {% endblock %}
  </main>
</div>
<footer class="bg-dark text-light mt-auto py-4">
  <div class="container">
    <div class="row">

      <!-- Información del hospital -->
      <div class="col-md-4 mb-3">
        <h5 class="fw-bold">Hospital Padre Hurtado</h5>
        <p class="small mb-1">Av. Concha y Toro 3459</p>
        <p class="small mb-1">San Ramón, Santiago, Chile</p>
        <p class="small">Teléfono: <strong>(2) 2576 3000</strong></p>
      </div>

      <!-- Links de navegación -->
      <div class="col-md-4 mb-3">
        <h6 class="fw-bold">Navegación</h6>
        <ul class="list-unstyled small">
          <li><a href="/" class="text-light text-decoration-none">Inicio</a></li>
          <li><a href="/farmacia/" class="text-light text-decoration-none">Inventario Farmacia</a></li>
          <li><a href="/bodega/" class="text-light text-decoration-none">Inventario Bodega</a></li>
          <li><a href="/reportes/" class="text-light text-decoration-none">Reportes</a></li>
        </ul>
      </div>

      <!-- Información de sistema -->
      <div class="col-md-4 mb-3">
        <h6 class="fw-bold">Sistema de Control de Inventario</h6>
        <p class="small mb-1">Versión 1.0</p>
        <p class="small mb-1">Desarrollado para gestión interna.</p>
        <p class="small">© {{ now|date:"Y" }} Hospital Padre Hurtado</p>
      </div>

    </div>
</footer>
</body>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</html>