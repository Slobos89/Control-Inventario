{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block titlepage %}Sistema Inventario - Hospital Padre Hurtado{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    body { background:#f7f9fc; }
    .sidebar { min-width: 220px; max-width: 260px; background: #fff; border-right:1px solid #e6eef8; height:100vh; padding-top:1rem; position:fixed; }
    main.flex-fill { margin-left: 260px; }
    .app-header { background: #0d6efd; color: #fff; }
    .card-compact { border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
    .nav-link.active { background: rgba(13,110,253,0.08); border-radius:6px; color:#0d6efd !important; }
    .small-muted { font-size:0.85rem; color:#ffffff; }
    .sidebar .nav { padding-left:0; }
    .sidebar .nav-link { color:#333; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg app-header">
  <div class="container-fluid">
    <a class="navbar-brand text-white" href="{% url 'admin_dashboard' %}">Inventario - Hospital Padre Hurtado</a>
    <div class="d-flex">
      {% if request.user.is_authenticated %}
          <div class="d-flex flex-column align-items-center text-white" style="min-width:80px;">

          <!-- Icono de usuario más pequeño -->
          <div class="rounded-circle bg-white d-flex justify-content-center align-items-center shadow" style="width:35px; height:35px;">
            <i class="bi bi-person-fill" style="font-size:18px; color:#0d6efd;"></i>
          </div>

          <!-- Nombre del usuario -->
          <div style="font-size:0.75rem; margin-top:3px; text-align:center;">
            <strong>{{ user.username }}</strong>
          </div>

          <!-- Botón cerrar sesión (tamaño exacto) -->
          <a href="{% url 'logout' %}" class="btn btn-outline-light btn-sm mt-1" style="font-size:0.70rem; padding: 2px 6px; white-space: nowrap; width: auto !important;">
            <i class="bi bi-box-arrow-right"></i>
            Salir
          </a>

        </div>

      {% else %}
        <a class="btn btn-outline-light btn-sm" href="{% url 'login' %}">Iniciar sesión</a>
      {% endif %}
    </div>
  </div>
</nav>

<div class="d-flex">
  <aside class="sidebar p-3">
    <h6 class="px-3">Menú</h6>
    {% with current=request.resolver_match.url_name %}
    <ul class="nav flex-column">
    {% if request.user.is_authenticated %}
    
      {% if request.user.perfil.rol == "ADMIN" %}
      <!-- Dashboard del administrador -->
      <li class="nav-item">
        <a class="nav-link {% if current == 'admin_dashboard' %}active{% endif %}" href="{% url 'admin_dashboard' %}">
            Dashboard Admin
        </a>
      </li>
      {% endif %}

      {% if request.user.perfil.rol == "JEFE_BODEGA" %}
      <li class="nav-item">
        <a class="nav-link {% if current == 'bodega_dashboard' %}active{% endif %}" href="{% url 'jefe_bodega_dashboard' %}">
            Panel de Bodega
        </a>
      </li>
      {% endif %}

      {% if request.user.perfil.rol == "JEFE_FARMACIA" %}
      <li class="nav-item">
        <a class="nav-link {% if current == 'farmacia_dashboard' %}active{% endif %}" href="{% url 'jefe_farmacia_dashboard' %}">
            Panel de Farmacia
        </a>
      </li>
      {% endif %}

    {% endif %}
      <li class="nav-item">
        <a class="nav-link {% if current == 'inventory_list' %}active{% endif %}" href="{% url 'inventory_list' %}">Inventario</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if current == 'register_entry' %}active{% endif %}" href="{% url 'register_entry' %}">Ingresos</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if current == 'review_received' %}active{% endif %}" href="{% url 'review_received' %}">Revisar recepción</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if current == 'requests' %}active{% endif %}" href="{% url 'requests' %}">Solicitudes</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if current == 'dispense' %}active{% endif %}" href="{% url 'dispense' %}">Dispensación</a>
      </li>
      <li class="nav-item">
        <a class="nav-link {% if current == 'reports' %}active{% endif %}" href="{% url 'reports' %}">Reportes</a>
      </li>
      {% if user.is_authenticated and user.is_superuser %}
      <li class="nav-item">
        <a class="nav-link {% if current == 'manage_users' %}active{% endif %}" href="{% url 'manage_users' %}">Usuarios</a>
      </li>
      {% endif %}
    </ul>
    {% endwith %}
  </aside>

  <main class="flex-fill p-4">
    {% block principal %}
    {% endblock %}
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>