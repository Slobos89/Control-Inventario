{% extends "core/base.html" %}
{% block titlepage %}Reportes{% endblock %}

{% block principal %}
<div class="container mt-4">
  <h4>Reportes y estadísticas</h4>

  <form class="row g-3 align-items-end mb-3" method="get" action="{% url 'reports' %}">
    <div class="col-md-3">
      <label class="form-label">Fecha desde</label>
      <input class="form-control" type="date" name="from">
    </div>

    <div class="col-md-3">
      <label class="form-label">Fecha hasta</label>
      <input class="form-control" type="date" name="to">
    </div>

  

    <div class="col-md-3">
      <button class="btn btn-primary">Generar</button>
    </div>
  </form>

  <div class="card p-3">
    <h6>Resultados</h6>
    <table class="table table-sm">
      <thead><tr><th>Fecha</th><th>Tipo</th><th>Descripción</th><th>Cantidad</th><th>Acciones</th></tr></thead>
      <tbody>
      {% if user.perfil.rol == "JEFE_BODEGA" %}
        {% if movimientosB %}
          {% for mov in movimientosB %}
            <tr>
              <td>{{ mov.fecha|date:"Y-m-d H:i" }}</td>
              <td>{{ mov.tipo }}</td>
              <td>{{ mov.insumo.nombre }}</td>
              <td>{{ mov.cantidad }}</td>
              <td><button class="btn btn-sm btn-outline-secondary">Exportar</button></td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="4" class="text-center text-muted">
              No hay movimientos registrados.
            </td>
          </tr>
        {% endif %}
      {% endif %}
      {% if user.perfil.rol == "JEFE_FARMACIA" %}
        {% if movimientosF %}
          {% for mov in movimientosF %}
            <tr>
              <td>{{ mov.fecha|date:"Y-m-d H:i" }}</td>
              <td>{{ mov.tipo }}</td>
              
              <!-- Mostrar el nombre correcto: medicamento o insumo -->
              <td>
                {% if mov.medicamento %}
                    {{ mov.medicamento.nombre }} 
                {% elif mov.insumo %}
                    {{ mov.insumo.nombre }} 
                {% else %}
                    Sin descripción
                {% endif %}
              </td>
              <td>{{ mov.cantidad }}</td>
              <td>
                <button class="btn btn-sm btn-outline-secondary">Exportar</button>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="4" class="text-center text-muted">
                No hay movimientos registrados.
            </td>
          </tr>
        {% endif %}
      {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}